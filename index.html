<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Color Geo-Guesser Game</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f5f5f5;
    color: #333;
  }
  header {
    text-align: center;
    padding: 20px;
    background: #4CAF50;
    color: white;
  }
  header h1 {
    margin: 0;
    font-size: 2em;
  }
  header p {
    margin: 5px 0 0;
    font-size: 0.9em;
  }
  .container {
    display: flex;
    gap: 20px;
    padding: 20px;
    flex-wrap: wrap;
  }
  .column {
    flex: 1;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    min-width: 280px;
  }
  h2 {
    margin-top: 0;
  }
  input, button {
    width: 96%;
    padding: 8px;
    margin: 6px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  button {
    background: #4CAF50;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border: none;
  }
  button:hover {
    background: #45a049;
  }
  .game-area {
    text-align: center;
  }
  #target {
    width: 150px;
    height: 150px;
    margin: 0 auto 10px;
    border-radius: 8px;
    box-shadow: 0 0 5px rgba(0,0,0,0.2);
  }
  canvas {
    border-radius: 50%;
    cursor: crosshair;
    margin: 10px 0;
  }
  .scores {
    display: flex;
    justify-content: space-around;
    margin-top: 10px;
    font-weight: bold;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
  }
  table th, table td {
    border: 1px solid #ddd;
    padding: 5px;
    text-align: center;
  }
  table th {
    background: #eee;
  }
  .color-box {
    width: 25px;
    height: 25px;
    border: 1px solid #ccc;
    display: inline-block;
  }
  /* Tutorial overlay */
  #tutorial-section {
    display: none;
    padding: 15px;
    background: #fff3cd;
    border: 1px solid #ffeeba;
    border-radius: 5px;
    margin: 15px;
  }
  /* Mobile responsive fix */
  @media (max-width: 768px) {
    .container {
      flex-direction: column;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Color Geo-Guesser</h1>
  <p>Inspired by <a href="https://www.youtube.com/shorts/BWbMxeNv_Qg" target="_blank" style="color:white;text-decoration:underline;">The Studio</a> â€” all credits go to them</p>
</header>

<div style="text-align:center; margin-top:10px;">
  <button onclick="toggleTutorial()">Tutorial</button>
</div>
<div id="tutorial-section">
  <h3>How to Play</h3>
  <p>
    This is a two-player color matching game. A target color will appear on the left side.  
    Players take turns clicking on the color wheel to choose the color they think matches the target.  
    The closer your chosen color is to the target, the lower your score for that turn.  
  </p>
  <p>
    After both players have played, the round ends and scores are recorded.  
    After the set number of rounds, the player with the lowest total score wins.  
  </p>
  <button onclick="toggleTutorial()">Close Tutorial</button>
</div>

<div class="container">
  <!-- Column 1: Setup -->
  <div class="column">
    <h2>Setup</h2>
    <label>Player 1 Name:</label>
    <input type="text" id="player1" placeholder="Enter name">
    <label>Player 2 Name:</label>
    <input type="text" id="player2" placeholder="Enter name">
    <label>Number of Rounds:</label>
    <input type="number" id="rounds" min="1" value="5">
    <button style="width: 100%" onclick="startGame()">Start Game</button>
    <button style="width: 100%" onclick="resetGame()">Reset Game</button>
  </div>

  <!-- Column 2: Game -->
  <div class="column game-area">
    <h2>Game</h2>
    <p>Round: <span id="roundNumber">0</span> / <span id="totalRounds">0</span></p>
    <div id="target"></div>
    <canvas id="wheel" width="300" height="300"></canvas>
    <div class="scores">
      <span id="p1Score">P1: 0</span>
      <span id="p2Score">P2: 0</span>
    </div>
  </div>

  <!-- Column 3: Score Table -->
  <div class="column">
    <h2>Round Scores</h2>
    <table id="scoreTable">
      <thead>
        <tr>
          <th>Round</th>
          <th>Player</th>
          <th>Target</th>
          <th>Guess</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
let ctx = document.getElementById('wheel').getContext('2d');
let targetColor, targetHSL;
let currentPlayer = 1;
let p1Total = 0, p2Total = 0;
let roundsToPlay = 0, currentTurn = 0;
let roundData = [];

function toggleTutorial(){
  let sec = document.getElementById('tutorial-section');
  sec.style.display = sec.style.display === 'block' ? 'none' : 'block';
}

function hslToRgb(h, s, l) {
  let r, g, b;
  if (s === 0) r = g = b = l;
  else {
    const hue2rgb = (p, q, t) => {
      if (t < 0) t += 1;
      if (t > 1) t -= 1;
      if (t < 1/6) return p + (q - p) * 6 * t;
      if (t < 1/2) return q;
      if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    };
    const q = l < 0.5 ? l * (1 + s) : l + s - l*s;
    const p = 2 * l - q;
    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }
  return [Math.round(r*255), Math.round(g*255), Math.round(b*255)];
}

function drawColorWheel(){
  const radius = 150;
  const img = ctx.createImageData(300, 300);
  const data = img.data;
  for (let y = -radius; y < radius; y++) {
    for (let x = -radius; x < radius; x++) {
      const dx = x / radius;
      const dy = y / radius;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist <= 1) {
        let angle = Math.atan2(dy, dx);
        if (angle < 0) angle += 2 * Math.PI;
        const hue = angle * 180 / Math.PI;
        const sat = dist;
        const light = 0.5;
        const [r,g,b] = hslToRgb(hue/360, sat, light);
        const px = ((y+radius)*300 + (x+radius)) * 4;
        data[px] = r; data[px+1] = g; data[px+2] = b; data[px+3] = 255;
      }
    }
  }
  ctx.putImageData(img, 0, 0);
}

function randomColor(){
  return { h: Math.random()*360, s: 1, l: 0.5 };
}

function setTarget(){
  targetHSL = randomColor();
  const [r,g,b] = hslToRgb(targetHSL.h/360, targetHSL.s, targetHSL.l);
  document.getElementById('target').style.backgroundColor = `rgb(${r},${g},${b})`;
}

function startGame(){
  let p1 = document.getElementById('player1').value || "Player 1";
  let p2 = document.getElementById('player2').value || "Player 2";
  roundsToPlay = parseInt(document.getElementById('rounds').value) || 5;
  document.getElementById('totalRounds').textContent = roundsToPlay;
  document.getElementById('roundNumber').textContent = 1;
  p1Total = p2Total = 0;
  currentPlayer = 1;
  currentTurn = 1;
  roundData = [];
  document.querySelector('#scoreTable tbody').innerHTML = '';
  document.getElementById('p1Score').textContent = `${p1}: 0`;
  document.getElementById('p2Score').textContent = `${p2}: 0`;
  setTarget();
}

function resetGame(){
  location.reload();
}

function colorDistance(c1, c2){
  return Math.sqrt((c1[0]-c2[0])**2 + (c1[1]-c2[1])**2 + (c1[2]-c2[2])**2);
}

document.getElementById('wheel').addEventListener('click', e => {
  if (!roundsToPlay) return;
  const rect = e.target.getBoundingClientRect();
  const x = e.clientX - rect.left - 150;
  const y = e.clientY - rect.top - 150;
  const dist = Math.sqrt(x*x + y*y);
  if (dist > 150) return;
  let angle = Math.atan2(y,x);
  if (angle < 0) angle += 2 * Math.PI;
  const hue = angle * 180 / Math.PI;
  const sat = dist / 150;
  const light = 0.5;
  const guessRGB = hslToRgb(hue/360, sat, light);
  const targetRGB = hslToRgb(targetHSL.h/360, targetHSL.s, targetHSL.l);
  const score = +colorDistance(guessRGB, targetRGB).toFixed(2);

  let pName = currentPlayer === 1 ? (document.getElementById('player1').value || "Player 1") : (document.getElementById('player2').value || "Player 2");
  let targetSwatch = `<div class='color-box' style="background: rgb(${targetRGB.join(',')})"></div>`;
  let guessSwatch = `<div class='color-box' style="background: rgb(${guessRGB.join(',')})"></div>`;
  
  roundData.push({round: Math.ceil(currentTurn/2), player: pName, target: targetSwatch, guess: guessSwatch, score});
  
  let row = `<tr>
    <td>${Math.ceil(currentTurn/2)}</td>
    <td>${pName}</td>
    <td>${targetSwatch}</td>
    <td>${guessSwatch}</td>
    <td>${score}</td>
  </tr>`;
  document.querySelector('#scoreTable tbody').insertAdjacentHTML('beforeend', row);

  if (currentPlayer === 1) p1Total += score; else p2Total += score;

  document.getElementById('p1Score').textContent = `${document.getElementById('player1').value || "Player 1"}: ${p1Total.toFixed(2)}`;
  document.getElementById('p2Score').textContent = `${document.getElementById('player2').value || "Player 2"}: ${p2Total.toFixed(2)}`;

  if (currentPlayer === 2) {
    if (Math.ceil(currentTurn/2) >= roundsToPlay) {
      let winner = p1Total < p2Total ? document.getElementById('player1').value || "Player 1" : document.getElementById('player2').value || "Player 2";
      let winScore = p1Total < p2Total ? p1Total.toFixed(2) : p2Total.toFixed(2);
      alert(`Winner: ${winner} with score ${winScore}`);
      roundsToPlay = 0;
      return;
    }
    document.getElementById('roundNumber').textContent = Math.ceil((currentTurn+1)/2);
  }
  currentPlayer = currentPlayer === 1 ? 2 : 1;
  currentTurn++;
  setTarget();
});

drawColorWheel();
</script>

</body>
</html>
