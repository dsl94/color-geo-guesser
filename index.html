<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Color Geo-Guesser</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    background: #f0f2f5;
    color: #333;
  }
  header {
    background: #4a90e2;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 1.5rem;
  }
  .container {
    display: grid;
    grid-template-columns: 1fr 2fr 1.5fr;
    gap: 20px;
    padding: 20px;
  }
  @media (max-width: 900px) {
    .container {
      grid-template-columns: 1fr;
    }
  }
  .card {
    background: white;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  }
  h2 {
    margin-top: 0;
    font-size: 1.2rem;
    color: #4a90e2;
  }
  input[type="text"], input[type="number"] {
    width: 100%;
    padding: 8px;
    margin: 5px 0 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
  }
  button {
    padding: 8px 14px;
    margin: 5px;
    background: #4a90e2;
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 0.95rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  button:hover {
    background: #3b7bc0;
  }
  #target {
    width: 150px;
    height: 150px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    margin-bottom: 10px;
  }
  canvas {
    border-radius: 50%;
    cursor: crosshair;
  }
  .score-summary {
    font-size: 1rem;
    margin-top: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }
  th, td {
    border-bottom: 1px solid #eee;
    padding: 6px;
    text-align: center;
  }
  .color-box {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    display: inline-block;
  }
  /* Tutorial section */
  #tutorial-section {
    display: none;
    background: white;
    border-radius: 12px;
    padding: 15px;
    margin-top: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  }
  #tutorial-section h3 {
    margin-top: 0;
    color: #4a90e2;
  }
</style>
</head>
<body>

<header>🎨 Color Geo-Guesser</header>

<div class="container">
  <!-- Column 1: Setup -->
  <div class="card">
    <h2>Setup</h2>
    <label>Player 1 Name:</label>
    <input type="text" id="player1" placeholder="Player 1">
    <label>Player 2 Name:</label>
    <input type="text" id="player2" placeholder="Player 2">
    <label>Number of Rounds:</label>
    <input type="number" id="rounds" min="1" value="5">
    <button id="start-btn">Start Game</button>
    <button id="reset-btn">Reset</button>
    <button id="tutorial-btn">Tutorial</button>

    <div id="tutorial-section">
      <h3>How to Play</h3>
      <p>
        In Color Geo-Guesser, two players compete to match a target color shown on the left by clicking on a color wheel.  
        <strong>Gameplay:</strong>  
        1. Player 1 clicks the color wheel to choose their guess.  
        2. Player 2 takes their turn.  
        3. Both players’ scores are based on how close their chosen color is to the target color (lower score = better match).  
        4. After the set number of rounds, the player with the lowest total score wins.
      </p>
      <p>Tip: Try to pick colors by matching hue and saturation closely for a better score.</p>
      <button onclick="document.getElementById('tutorial-section').style.display='none'">Close Tutorial</button>
    </div>
  </div>

  <!-- Column 2: Game -->
  <div class="card" style="text-align:center;">
    <h2>Game</h2>
    <div id="target"></div>
    <canvas id="wheel" width="250" height="250"></canvas>
    <div class="score-summary" id="score-summary">Scores will appear here</div>
  </div>

  <!-- Column 3: Score Table -->
  <div class="card">
    <h2>Score Table</h2>
    <table>
      <thead>
        <tr>
          <th>Round</th>
          <th>Player</th>
          <th>Target</th>
          <th>Guess</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody id="score-table-body"></tbody>
    </table>
  </div>
</div>

<script>
  const wheelCanvas = document.getElementById('wheel');
  const ctx = wheelCanvas.getContext('2d');
  const targetDiv = document.getElementById('target');
  const scoreSummary = document.getElementById('score-summary');
  const tableBody = document.getElementById('score-table-body');

  let playerNames = ["Player 1", "Player 2"];
  let totalRounds = 5;
  let currentPlayer = 0;
  let roundCount = 0;
  let scores = [0, 0];
  let targetColor;
  let gameActive = false;

  document.getElementById('start-btn').addEventListener('click', startGame);
  document.getElementById('reset-btn').addEventListener('click', resetGame);
  document.getElementById('tutorial-btn').addEventListener('click', () => {
    document.getElementById('tutorial-section').style.display = 'block';
  });

  function startGame() {
    playerNames[0] = document.getElementById('player1').value || "Player 1";
    playerNames[1] = document.getElementById('player2').value || "Player 2";
    totalRounds = parseInt(document.getElementById('rounds').value) || 5;
    resetGame();
    gameActive = true;
    newTarget();
    updateScoreSummary();
  }

  function resetGame() {
    scores = [0, 0];
    currentPlayer = 0;
    roundCount = 0;
    tableBody.innerHTML = '';
    scoreSummary.textContent = "Scores will appear here";
    gameActive = false;
  }

  function drawColorWheel() {
    const radius = wheelCanvas.width / 2;
    const image = ctx.createImageData(wheelCanvas.width, wheelCanvas.height);
    const data = image.data;

    for (let y = -radius; y < radius; y++) {
      for (let x = -radius; x < radius; x++) {
        const dx = x / radius;
        const dy = y / radius;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance <= 1) {
          let angle = Math.atan2(dy, dx);
          if (angle < 0) angle += 2 * Math.PI;
          const hue = angle * 180 / Math.PI;
          const saturation = distance;
          const lightness = 0.5;

          const [r, g, b] = hslToRgb(hue / 360, saturation, lightness);
          const px = ((y + radius) * wheelCanvas.width + (x + radius)) * 4;
          data[px] = r;
          data[px + 1] = g;
          data[px + 2] = b;
          data[px + 3] = 255;
        }
      }
    }
    ctx.putImageData(image, 0, 0);
  }

  function hslToRgb(h, s, l) {
    let r, g, b;
    if (s === 0) {
      r = g = b = l;
    } else {
      const hue2rgb = (p, q, t) => {
        if (t < 0) t += 1;
        if (t > 1) t -= 1;
        if (t < 1/6) return p + (q - p) * 6 * t;
        if (t < 1/2) return q;
        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
        return p;
      };
      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
      const p = 2 * l - q;
      r = hue2rgb(p, q, h + 1/3);
      g = hue2rgb(p, q, h);
      b = hue2rgb(p, q, h - 1/3);
    }
    return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
  }

  function newTarget() {
    const h = Math.random() * 360;
    const s = 1;
    const l = 0.5;
    targetColor = { h, s, l };
    const [r, g, b] = hslToRgb(h / 360, s, l);
    targetDiv.style.backgroundColor = `rgb(${r},${g},${b})`;
  }

  function colorDistance(c1, c2) {
    return Math.sqrt(
      Math.pow(c1[0] - c2[0], 2) +
      Math.pow(c1[1] - c2[1], 2) +
      Math.pow(c1[2] - c2[2], 2)
    );
  }

  wheelCanvas.addEventListener('click', e => {
    if (!gameActive) return;
    const rect = wheelCanvas.getBoundingClientRect();
    const x = e.clientX - rect.left - wheelCanvas.width / 2;
    const y = e.clientY - rect.top - wheelCanvas.height / 2;
    const distance = Math.sqrt(x * x + y * y);
    if (distance > wheelCanvas.width / 2) return;

    let angle = Math.atan2(y, x);
    if (angle < 0) angle += 2 * Math.PI;
    const hue = angle * 180 / Math.PI;
    const saturation = distance / (wheelCanvas.width / 2);
    const lightness = 0.5;
    const guessRGB = hslToRgb(hue / 360, saturation, lightness);

    const targetRGB = hslToRgb(targetColor.h / 360, targetColor.s, targetColor.l);
    const dist = colorDistance(guessRGB, targetRGB);
    const maxDist = Math.sqrt(3 * Math.pow(255, 2));
    const score = +(dist / maxDist).toFixed(3);

    scores[currentPlayer] += score;
    addTableRow(currentPlayer, guessRGB, targetRGB, score);

    if (currentPlayer === 1) {
      roundCount++;
      if (roundCount >= totalRounds) {
        gameActive = false;
        let winner = scores[0] < scores[1] ? playerNames[0] : playerNames[1];
        let winnerScore = Math.min(scores[0], scores[1]).toFixed(3);
        alert(`🏆 Winner: ${winner} with score ${winnerScore}`);
      } else {
        newTarget();
      }
    }
    currentPlayer = 1 - currentPlayer;
    updateScoreSummary();
  });

  function addTableRow(playerIndex, guessRGB, targetRGB, score) {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${roundCount + (playerIndex === 1 ? 1 : 0)}</td>
      <td>${playerNames[playerIndex]}</td>
      <td><div class="color-box" style="background: rgb(${targetRGB.join(',')})"></div></td>
      <td><div class="color-box" style="background: rgb(${guessRGB.join(',')})"></div></td>
      <td>${score}</td>
    `;
    tableBody.appendChild(row);
  }

  function updateScoreSummary() {
    scoreSummary.textContent = `${playerNames[0]}: ${scores[0].toFixed(3)} | ${playerNames[1]}: ${scores[1].toFixed(3)} | Round ${roundCount}/${totalRounds}`;
  }

  drawColorWheel();
</script>

</body>
</html>
